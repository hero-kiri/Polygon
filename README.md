# Оптимизированный прокси-сервис для Polygon.io

## Обзор
Этот проект представляет собой оптимизированный прокси-сервис, предназначенный для взаимодействия с внешним API [Polygon.io](https://polygon.io). Цель проекта — минимизировать нагрузку на API Polygon.io, одновременно улучшив скорость и эффективность доставки данных клиентам.

Polygon.io — это платформа, которая предоставляет высококачественные финансовые данные и API для разработчиков. Этот прокси-сервис действует как промежуточное звено, кэшируя ответы и оптимизируя извлечение данных для клиентских приложений.

---

## Особенности

- **Кэширование с использованием Redis:** Хранение часто запрашиваемых данных для сокращения избыточных вызовов API.
- **Ограничение скорости:** Обеспечивает соблюдение политики использования API Polygon.io.
- **Обработка ошибок:** Грамотная обработка ошибок и обеспечение надежности клиента.
- **Масштабируемость:** Готовность к масштабированию с добавлением клиентов или увеличением объема запросов.

---

## Требования

- **Python 3.11**
- **FastAPI**
- **Redis**
- **Docker и Docker Compose**

---

## Установка и настройка

### Предварительные требования

1. Установите [Docker](https://docs.docker.com/get-docker/) и [Docker Compose](https://docs.docker.com/compose/install/).
2. Убедитесь, что у вас есть доступ к ключу API Polygon.io.

### Клонирование репозитория
```bash
git clone git@github.com:hero-kiri/Polygon.git
cd Polygon
```

### Настройка

Создайте файл `.env` в корневом каталоге и добавьте следующее:
```env
API_KEY=your_polygon_api_key
BASE_URL=https://api.polygon.io/v2/aggs/ticker
REDIS_HOST=localhost
REDIS_PORT=6379
```

### Сборка и запуск с Docker Compose

1. Построить и запустить контейнеры:
   ```bash
   docker-compose up --build
   ```
2. Доступ к сервису будет по адресу `http://localhost:8000`.
3. Документация к сервису будет по адресу `http://localhost:8000/docs`.

---

## API Эндпоинты

### 1. Получение данных по тикеру
- **Эндпоинт:** `purchase/`
- **Метод:** `POST`
- **Описание:** Получает агрегированные данные для указанного тикера. Если данные доступны, они возвращаются из кэша Redis.

**Пример запроса:**
```bash
post http://localhost:8000/purchase/

data = {
  "ticker": "AAPL",
  "multiplier": 1,
  "timespan": "week",
  "start_date": "2022-02-12",
  "end_date": "2022-02-13"
}
```

**Пример ответа:**
```json
{
  "source": "cache",
  "data": {
    "ticker": "AAPL",
    "queryCount": 10,
    "resultsCount": 2,
    "adjusted": true,
    "results": [
      {
        "v": 412491545,
        "vw": 172.9816,
        "o": 172.86,
        "c": 168.64,
        "h": 176.65,
        "l": 168.04,
        "t": 1644123600000,
        "n": 3357351
      },
      {
        "v": 363973562,
        "vw": 169.7229,
        "o": 167.37,
        "c": 167.3,
        "h": 173.34,
        "l": 166.19,
        "t": 1644728400000,
        "n": 3135169
      }
    ],
    "status": "OK",
    "request_id": "bfa189c94836c6419b104705b53e515b",
    "count": 2
  }
}
```